"use strict";var __defProp=Object.defineProperty;var __defProps=Object.defineProperties;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropDescs=Object.getOwnPropertyDescriptors;var __getOwnPropNames=Object.getOwnPropertyNames;var __getOwnPropSymbols=Object.getOwnPropertySymbols;var __hasOwnProp=Object.prototype.hasOwnProperty;var __propIsEnum=Object.prototype.propertyIsEnumerable;var __typeError=msg=>{throw TypeError(msg)};var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:true,configurable:true,writable:true,value}):obj[key]=value;var __spreadValues=(a,b)=>{for(var prop in b||(b={}))if(__hasOwnProp.call(b,prop))__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b)){if(__propIsEnum.call(b,prop))__defNormalProp(a,prop,b[prop])}return a};var __spreadProps=(a,b)=>__defProps(a,__getOwnPropDescs(b));var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:true})};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from==="object"||typeof from==="function"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toCommonJS=mod=>__copyProps(__defProp({},"__esModule",{value:true}),mod);var __accessCheck=(obj,member,msg)=>member.has(obj)||__typeError("Cannot "+msg);var __privateGet=(obj,member,getter)=>(__accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj));var __privateAdd=(obj,member,value)=>member.has(obj)?__typeError("Cannot add the same private member more than once"):member instanceof WeakSet?member.add(obj):member.set(obj,value);var __privateSet=(obj,member,value,setter)=>(__accessCheck(obj,member,"write to private field"),setter?setter.call(obj,value):member.set(obj,value),value);var __privateMethod=(obj,member,method)=>(__accessCheck(obj,member,"access private method"),method);var index_exports={};__export(index_exports,{BrowserRoute:()=>BrowserRoute,BrowserRouteType:()=>BrowserRouteType,DefaultNestedLevel:()=>DefaultNestedLevel,DefaultRoute:()=>DefaultRoute,HashRoute:()=>HashRoute,HashRouteType:()=>HashRouteType,Router:()=>Router,_404RRoute:()=>_404RRoute,routeLocation:()=>routeLocation,router:()=>router});module.exports=__toCommonJS(index_exports);var BrowserRouteType="BrowserRoute";var HashRouteType="HashRoute";var DefaultNestedLevel=0;var _404RRoute={element:()=>{throw new Error("Page not found")},params:{},isSubRoute:false,nestedLevel:DefaultNestedLevel};var DefaultRoute={"*":_404RRoute};var _location,_routes,_disposeCb,_RouterManagement_instances,splitPath_fn,setParamsKeys_fn,setParamsValues_fn,getQueryString_fn,getHash_fn,getParams_fn,getPath_fn,checkEqualPath_fn,removeQueryParams_fn,removeHash_fn,removeQueryParamsAndHash_fn,getRoute_fn,directRoute_fn,directNestedRoute_fn,updateHistory_fn,unMount_fn,isNotSameRoute_fn,routePath_fn,push_fn,setLocation_fn,routeConfig_fn;var RouterManagement=class{constructor(){__privateAdd(this,_RouterManagement_instances);__privateAdd(this,_location,{pathname:"/",params:{},search:{},hash:""});__privateAdd(this,_routes,DefaultRoute);__privateAdd(this,_disposeCb,{});this.routeType=BrowserRouteType}getRoutes(){return __privateGet(this,_routes)}go(searchPathname,options){if(this.routeType===HashRouteType&&!searchPathname.startsWith("/#")){searchPathname=`/#`+searchPathname}__privateMethod(this,_RouterManagement_instances,push_fn).call(this,searchPathname,options)}dispose(cb){if(cb){const{pathname}=this.getLocation();__privateGet(this,_disposeCb)[pathname]=cb}}getLocation(){return __privateGet(this,_location)}back(){window.history.back()}forward(){window.history.forward()}refresh(){window.location.reload()}replace(searchPathname,state){let pathname=searchPathname;if(this.routeType===HashRouteType){pathname=`/#${searchPathname}`}__privateMethod(this,_RouterManagement_instances,push_fn).call(this,pathname,{state,addToHistory:false},true)}config(routeData,basePath=""){__privateMethod(this,_RouterManagement_instances,routeConfig_fn).call(this,routeData,basePath)}};_location=new WeakMap;_routes=new WeakMap;_disposeCb=new WeakMap;_RouterManagement_instances=new WeakSet;splitPath_fn=function(path){return path.split("/").slice(2)};setParamsKeys_fn=function(paramsKey){return paramsKey.reduce((obj,key)=>__spreadProps(__spreadValues({},obj),{[key]:""}),{})};setParamsValues_fn=function({paramsKey,paramsValue}){return paramsKey.reduce((obj,key,index)=>{var _a;return __spreadProps(__spreadValues({},obj),{[key]:(_a=paramsValue[index])!=null?_a:""})},{})};getQueryString_fn=function(path){const pathWithoutHash=__privateMethod(this,_RouterManagement_instances,removeHash_fn).call(this,path);const str=pathWithoutHash.indexOf("?");if(str>-1){const queryString=pathWithoutHash.slice(str+1);const queryStringArr=queryString.split("&");return queryStringArr.reduce((obj,queryParams)=>{const[key,value]=queryParams.split("=");return __spreadProps(__spreadValues({},obj),{[key]:value})},{})}return{}};getHash_fn=function(path){const str=path.lastIndexOf("#");return str>-1?path.slice(str):""};getParams_fn=function({pathname,searchedPathname}){const routeInfo=__privateGet(this,_routes)[pathname];const paramsValue=__privateMethod(this,_RouterManagement_instances,splitPath_fn).call(this,searchedPathname);const paramsKey=Object.keys(routeInfo.params);return __privateMethod(this,_RouterManagement_instances,setParamsValues_fn).call(this,{paramsKey,paramsValue})};getPath_fn=function(inputStr){const pattern=/^\/[a-zA-Z0-9\\-]*|[\\/]/;const match=inputStr.match(pattern);return match==null?void 0:match[0]};checkEqualPath_fn=function({searchedPathname,pathname}){const searchPathnameArr=__privateMethod(this,_RouterManagement_instances,removeQueryParamsAndHash_fn).call(this,searchedPathname).split("/");const pathnameArr=pathname.split("/");if(searchPathnameArr.length===pathnameArr.length){return pathnameArr.every((path,index)=>path.indexOf(":")>=0||path.indexOf(":")<0&&searchPathnameArr[index]===path)}return false};removeQueryParams_fn=function(path){const paramsPos=path.indexOf("?");return paramsPos>-1?path.slice(0,paramsPos):path};removeHash_fn=function(path){const hashPosition=path.indexOf("#");return hashPosition>-1?path.slice(0,hashPosition):path};removeQueryParamsAndHash_fn=function(path){const pathWithoutHash=__privateMethod(this,_RouterManagement_instances,removeHash_fn).call(this,path);return __privateMethod(this,_RouterManagement_instances,removeQueryParams_fn).call(this,pathWithoutHash)};getRoute_fn=function(searchedPathname){const searchedPath=__privateMethod(this,_RouterManagement_instances,getPath_fn).call(this,searchedPathname);let routeData=__privateGet(this,_routes)["*"];let pathInfo="*";for(const pathname in __privateGet(this,_routes)){const routeInfo=__privateGet(this,_routes)[pathname];const path=__privateMethod(this,_RouterManagement_instances,getPath_fn).call(this,pathname);if(!__privateMethod(this,_RouterManagement_instances,checkEqualPath_fn).call(this,{searchedPathname,pathname})){continue}pathInfo=pathname;if(pathname===searchedPathname){routeData=routeInfo;break}if(!searchedPath||path===searchedPath){routeData=__spreadProps(__spreadValues({},routeInfo),{params:__privateMethod(this,_RouterManagement_instances,getParams_fn).call(this,{pathname,searchedPathname:__privateMethod(this,_RouterManagement_instances,removeQueryParamsAndHash_fn).call(this,searchedPathname)})});break}}return __spreadProps(__spreadValues({},routeData),{pathname:pathInfo,search:__privateMethod(this,_RouterManagement_instances,getQueryString_fn).call(this,searchedPathname),hash:__privateMethod(this,_RouterManagement_instances,getHash_fn).call(this,searchedPathname)})};directRoute_fn=function(routeRenderEle,routeData){const{nestedLevel,element}=routeData;const routeEle=routeRenderEle[nestedLevel];if(routeEle){routeEle.innerHTML="";routeEle.appendChild(element())}};directNestedRoute_fn=function(searchPathname,routeData){const{nestedLevel,pathname}=routeData;const renderRouteEle=[...document.querySelectorAll('[data-vanilla-route-ele="router-wrap"]')];const routeElementsLen=renderRouteEle.length-1;const cleanPath=__privateMethod(this,_RouterManagement_instances,removeQueryParamsAndHash_fn).call(this,searchPathname).split("/");const pathArr=pathname==="*"?cleanPath.slice(1):cleanPath.slice(1,nestedLevel+2);const searchPathArr=pathArr.splice(routeElementsLen);let nextPath=routeElementsLen>0?`/${pathArr.splice(0,routeElementsLen).join("/")}`:"";const fragment=document.createDocumentFragment();for(const[index,path]of searchPathArr.entries()){const renderEleFragment=[...fragment.querySelectorAll('[data-vanilla-route-ele="router-wrap"]')];const routeFragmentEle=index===0?fragment:renderEleFragment[index-1];const routeInfo=__privateMethod(this,_RouterManagement_instances,getRoute_fn).call(this,`${nextPath}/${path}`);nextPath+=`/${path}`;if(routeInfo.pathname==="*"){routeFragmentEle==null?void 0:routeFragmentEle.appendChild(__privateGet(this,_routes)["*"].element());break}else{routeFragmentEle==null?void 0:routeFragmentEle.appendChild(routeInfo.element())}}const routeEle=renderRouteEle[routeElementsLen];if(routeEle){routeEle.innerHTML="";routeEle.appendChild(fragment)}};updateHistory_fn=function({addToHistory,replaceState,state,pathname}){if(replaceState){history.replaceState(state,"",pathname)}else if(addToHistory){history.pushState(__spreadProps(__spreadValues({},state),{pathname}),"",pathname)}};unMount_fn=function(){var _a,_b;const{pathname:closingRoutePath}=this.getLocation();(_b=(_a=__privateGet(this,_disposeCb))[closingRoutePath])==null?void 0:_b.call(_a);delete __privateGet(this,_disposeCb)[closingRoutePath]};isNotSameRoute_fn=function(searchPathname){const{pathname:closingRoutePath}=this.getLocation();return closingRoutePath==="/"||closingRoutePath!==searchPathname};routePath_fn=function(pathname){if(this.routeType===HashRouteType){return pathname.slice(2)}return pathname};push_fn=function(searchPathname,options,replaceState=false){const routePath=__privateMethod(this,_RouterManagement_instances,routePath_fn).call(this,searchPathname);if(__privateMethod(this,_RouterManagement_instances,isNotSameRoute_fn).call(this,routePath)){const{state={},addToHistory=true}=options!=null?options:{};const routeData=__privateMethod(this,_RouterManagement_instances,getRoute_fn).call(this,routePath);const{params,search,hash,pathname,nestedLevel}=routeData;__privateMethod(this,_RouterManagement_instances,unMount_fn).call(this);__privateMethod(this,_RouterManagement_instances,setLocation_fn).call(this,{pathname:routePath,params,search,hash});__privateMethod(this,_RouterManagement_instances,updateHistory_fn).call(this,{addToHistory,replaceState,state,pathname:searchPathname});const routeRenderEle=[...document.querySelectorAll('[data-vanilla-route-ele="router-wrap"]')];if(routeRenderEle.length-1>=nestedLevel&&pathname!=="*"){__privateMethod(this,_RouterManagement_instances,directRoute_fn).call(this,routeRenderEle,routeData)}else{__privateMethod(this,_RouterManagement_instances,directNestedRoute_fn).call(this,routePath,routeData)}window.scrollTo(0,0)}};setLocation_fn=function(obj){__privateSet(this,_location,obj)};routeConfig_fn=function(routeData,basePath="",nestedLevel=DefaultNestedLevel){routeData.forEach(routeInfo=>{const pathname=`${basePath}${routeInfo.pathname}`;const paramsKey=__privateMethod(this,_RouterManagement_instances,splitPath_fn).call(this,pathname.replaceAll(":",""));__privateGet(this,_routes)[pathname]={element:routeInfo.element,params:pathname.indexOf(":")>=0?__privateMethod(this,_RouterManagement_instances,setParamsKeys_fn).call(this,paramsKey):{},isSubRoute:Boolean(basePath),nestedLevel};if(routeInfo.children){__privateMethod(this,_RouterManagement_instances,routeConfig_fn).call(this,routeInfo.children,pathname,nestedLevel+1)}})};var _routeSetup,_RouterSetup_instances,init_fn,backListener_fn,addListener_fn,checkRouteSetup_fn,appendHash_fn;var RouterSetup=class extends RouterManagement{constructor(){super(...arguments);__privateAdd(this,_RouterSetup_instances);__privateAdd(this,_routeSetup,false)}browserRoute(routeData){const{origin,href}=new URL(window.location.href);__privateMethod(this,_RouterSetup_instances,init_fn).call(this,BrowserRouteType,routeData);const pathname=href.slice(origin.length);this.go(pathname)}hashRoute(routeData){const{origin,href}=new URL(window.location.href);__privateMethod(this,_RouterSetup_instances,init_fn).call(this,HashRouteType,routeData);let pathname=href.slice(origin.length);__privateMethod(this,_RouterSetup_instances,appendHash_fn).call(this);if(!pathname.startsWith("/#")){pathname=`/#${pathname}`;window.location.href=`${origin}${pathname}`}this.go(pathname)}};_routeSetup=new WeakMap;_RouterSetup_instances=new WeakSet;init_fn=function(routeType,routeData){this.routeType=routeType;__privateMethod(this,_RouterSetup_instances,checkRouteSetup_fn).call(this);this.config(routeData);__privateMethod(this,_RouterSetup_instances,backListener_fn).call(this);__privateMethod(this,_RouterSetup_instances,addListener_fn).call(this)};backListener_fn=function(){window.addEventListener("popstate",event=>{const{pathname=""}=event.state||{};if(pathname){this.go(pathname,{state:{},addToHistory:false})}})};addListener_fn=function(){const links=document.querySelectorAll('a[data-vanilla-route-link="spa"]');if(links){links.forEach(link=>{link.addEventListener("click",event=>{var _a;event.preventDefault();const href=(_a=event.target.getAttribute("href"))!=null?_a:"";this.go(href)})})}};checkRouteSetup_fn=function(){if(__privateGet(this,_routeSetup)){this.go("/404");throw new Error("In the application you can only have 1 Route setup using either browserRoute() or hashRoute().")}__privateSet(this,_routeSetup,true)};appendHash_fn=function(){const links=document.querySelectorAll('a[data-vanilla-route-link="spa"]');if(links){links.forEach(link=>{const pathname=link.href.slice(link.origin.length);link.href=`/#${pathname}`})}};var Router=new RouterSetup;var BrowserRoute=routes=>Router.browserRoute(routes);var HashRoute=routes=>Router.hashRoute(routes);var routeLocation=()=>Router.getLocation();var router=()=>Router.getRoutes();0&&(module.exports={BrowserRoute,BrowserRouteType,DefaultNestedLevel,DefaultRoute,HashRoute,HashRouteType,Router,_404RRoute,routeLocation,router});
